<div class="w-full mx-auto px-2">
    <!-- Header -->
    <div class="flex justify-between items-center mb-8 px-4">
        <h1 class="text-3xl font-bold" style="color: #262626">Daftar Dokumen</h1>
        <% if (user.role === 'staff') { %>
        <a href="/documents/new" style="background-color: #00341f" class="hover:opacity-90 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            <span>Pengajuan Baru</span>
        </a>
        <% } %>
    </div>

    <!-- Documents Table -->
    <div class="bg-white rounded-lg shadow-lg overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200">
            <div class="flex justify-between items-center">
                <h2 class="text-xl font-semibold text-gray-800">Semua Dokumen</h2>
                <div class="flex items-center space-x-3">
                    <!-- Search -->
                    <div class="relative">
                        <input
                            type="text"
                            id="searchInput"
                            placeholder="Cari dokumen..."
                            class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:border-transparent text-sm"
                            style="focus:ring-color: #00341F" />
                        <svg class="w-5 h-5 text-gray-400 absolute left-3 top-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
        <div class="overflow-x-hidden overflow-y-auto">
            <table class="w-full table-fixed">
                <thead class="bg-gray-50 sticky top-0">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase" style="width: 3%">No</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase" style="width: 18%">Judul</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase" style="width: 20%">Deskripsi</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase" style="width: 10%">Dibuat</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase" style="width: 10%">Tanggal</th>
                        <th class="px-4 py-3 text-left text-xs font-medium uppercase" style="width: 15%">
                            <div class="flex items-center justify-between">
                                <span class="text-gray-500 text-xs">Status</span>
                                <div class="relative inline-block">
                                    <button id="statusFilterBtn" class="flex items-center space-x-1 text-xs px-2 py-1 rounded hover:bg-gray-200 transition" style="color: #00341f" title="Filter Status">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                                        </svg>
                                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                        </svg>
                                    </button>
                                    <div id="statusFilterDropdown" class="hidden absolute right-0 mt-1 w-48 bg-white rounded-lg shadow-xl border border-gray-200 z-50">
                                        <div class="py-1">
                                            <button class="status-filter-option w-full text-left px-4 py-2 text-sm hover:bg-gray-100 transition" data-status="all">
                                                <span class="font-medium">Semua Status</span>
                                            </button>
                                            <button class="status-filter-option w-full text-left px-4 py-2 text-sm hover:bg-gray-100 transition" data-status="approved">
                                                <span class="text-green-600">✓ Selesai</span>
                                            </button>
                                            <button class="status-filter-option w-full text-left px-4 py-2 text-sm hover:bg-gray-100 transition" data-status="in_review">
                                                <span style="color: #f0d323">⏳ Sedang Direview</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase" style="width: 10%">Dilihat</th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase" style="width: 14%">Status | Review</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    <% if (documents.length === 0) { %>
                    <tr>
                        <td colspan="8" class="px-6 py-12 text-center text-gray-500">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <p class="mt-2">Belum ada dokumen</p>
                        </td>
                    </tr>
                    <% } else { %> <% documents.forEach((doc, index) => { %>
                    <tr class="document-row hover:bg-gray-50 transition" data-status="<%= doc.currentStatus %>" data-title="<%= doc.title.toLowerCase() %>" data-description="<%= doc.description.toLowerCase() %>">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= index + 1 %></td>
                        <td class="px-6 py-4">
                            <div class="text-sm font-medium text-gray-900"><%= doc.title %></div>
                            <a href="<%= doc.documentLink %>" target="_blank" class="text-sm hover:underline flex items-center" style="color: #00341f">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                </svg>
                                Buka Dokumen
                            </a>
                        </td>
                        <td class="px-6 py-4">
                            <div class="text-sm text-gray-600 max-w-xs truncate"><%= doc.description %></div>
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900">
                            <div class="max-w-[120px] truncate" title="<%= doc.createdBy %>"><%= doc.createdBy %></div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><%= doc.createdAt %></td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <% if (doc.currentStatus === 'in_review') { %> <% let reviewingBy = ''; if (doc.workflow.kasi.status === 'reviewing') { reviewingBy = 'Kasi'; } else if (doc.workflow.kasubdit.status === 'reviewing') { reviewingBy
                            = 'Kasubdit'; } else if (doc.workflow.direktur.status === 'reviewing') { reviewingBy = 'Direktur'; } %>
                            <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full" style="background-color: rgba(240, 211, 35, 0.2); color: #262626">Direview <%= reviewingBy %></span>
                            <% } else if (doc.currentStatus === 'approved') { %>
                            <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full" style="background-color: rgba(0, 52, 31, 0.15); color: #00341f">Disetujui</span>
                            <% } else if (doc.currentStatus === 'rejected') { %>
                            <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-orange-100 text-orange-700">Perlu Revisi</span>
                            <% } else { %>
                            <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full" style="background-color: rgba(38, 38, 38, 0.1); color: #262626">Draft</span>
                            <% } %>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <% let viewedByRelevant = false; if (doc.currentStatus === 'approved') { viewedByRelevant = true; } else if (doc.currentStatus === 'in_review') { if (doc.workflow.kasi.status === 'reviewing') { viewedByRelevant =
                            doc.workflow.kasi.viewed; } else if (doc.workflow.kasubdit.status === 'reviewing') { viewedByRelevant = doc.workflow.kasubdit.viewed; } else if (doc.workflow.direktur.status === 'reviewing') { viewedByRelevant =
                            doc.workflow.direktur.viewed; } } %> <% if (viewedByRelevant) { %>
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium" style="background-color: rgba(0, 52, 31, 0.1); color: #00341f">
                                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>
                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path>
                                </svg>
                                Sudah
                            </span>
                            <% } else { %>
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium" style="background-color: rgba(240, 211, 35, 0.2); color: #262626">
                                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path
                                        fill-rule="evenodd"
                                        d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z"
                                        clip-rule="evenodd"></path>
                                    <path d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z"></path>
                                </svg>
                                Belum
                            </span>
                            <% } %>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <div class="flex items-center justify-center space-x-2">
                                <%- include('partials/tracking-dropdown', { doc: doc, reviewers: reviewers }) %>
                                <a
                                    href="/documents/<%= doc.id %>/review"
                                    class="p-2 rounded-full transition"
                                    style="color: #00341f"
                                    onmouseover="this.style.backgroundColor='rgba(0,52,31,0.1)'"
                                    onmouseout="this.style.backgroundColor='transparent'"
                                    title="Review Dokumen">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                    </svg>
                                </a>
                            </div>
                        </td>
                    </tr>
                    <% }) %> <% } %>
                </tbody>
            </table>
        </div>
        <div id="noResults" class="hidden px-6 py-12 text-center text-gray-500">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <p class="mt-2 font-medium">Tidak ada dokumen yang sesuai</p>
            <p class="text-sm text-gray-400 mt-1">Coba ubah filter atau kata kunci pencarian</p>
        </div>
    </div>
</div>

<%- include('partials/filter-search') %>
